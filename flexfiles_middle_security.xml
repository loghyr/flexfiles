<!-- Copyright (C) The IETF Trust (2014) -->
<!-- Copyright (C) The Internet Society (2014) -->

<section anchor="sec:fencing" title="Client Fencing">
  <t>
    In cases where clients are uncommunicative and their lease has
    expired or when clients fail to return recalled layouts within
    a lease period, at the least the server MAY revoke client layouts
    and/or device address mappings and reassign these resources to
    other clients (see "Recalling a Layout" in <xref target='RFC5661' />).
    To avoid data corruption, the metadata server MUST fence
    off the revoked clients from the respective objects as described
    in <xref target='sec:sec_models' />.
 </t>
</section>

<section anchor="sec:security" title="Security Considerations">
  <t>
    The pNFS extension partitions the NFSv4 file system protocol
    into two parts, the control path and the data path (storage
    protocol).  The control path contains all the new operations
    described by this extension; all existing NFSv4 security
    mechanisms and features apply to the control path.  The combination
    of components in a pNFS system is required to preserve the
    security properties of NFSv4 with respect to an entity accessing
    data via a client, including security countermeasures to defend
    against threats that NFSv4 provides defenses for in environments
    where these threats are considered significant.
  </t>

  <t>
    The metadata server enforces the file access-control policy at
    LAYOUTGET time.  The client should use suitable authorization
    credentials for getting the layout for the requested iomode
    (READ or RW) and the server verifies the permissions and ACL
    for these credentials, possibly returning NFS4ERR_ACCESS if the
    client is not allowed the requested iomode.  If the LAYOUTGET
    operation succeeds the client receives, as part of the layout,
    a set of credentials allowing it I/O access to the specified
    objects corresponding to the requested iomode.  When the client
    acts on I/O operations on behalf of its local users, it MUST
    authenticate and authorize the user by issuing respective OPEN
    and ACCESS calls to the metadata server, similar to having NFSv4
    data delegations.  If access is allowed, the client uses the
    corresponding (READ or RW) credentials to perform the I/O
    operations at the object storage devices.  When the metadata
    server receives a request to change a file's permissions or
    ACL, it SHOULD recall all layouts for that file and it MUST
    fence off the clients holding outstanding layouts for the
    respective file by implicitly invalidating the outstanding
    credentials on all Component Objects comprising before committing
    to the new permissions and ACL.  Doing this will ensure that
    clients re-authorize their layouts according to the modified
    permissions and ACL by requesting new layouts.  Recalling the
    layouts in this case is courtesy of the server intended to
    prevent clients from getting an error on I/Os done after the
    client was fenced off.
  </t>
</section>
